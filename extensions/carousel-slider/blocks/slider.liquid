
<link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet"/>

{% if block.settings.selected_collection != blank %}
   {% assign collection = collections[block.settings.selected_collection].products %}
{% else %}
   {% assign collection = collections.all.products %}
{% endif %}

{% assign section_id = 'shv-carousel-' | append: section.id %}

{%- comment -%} Auto-detect aspect ratio from first product image {%- endcomment -%}
{% if collection.first.featured_image %}
  {% assign first_image = collection.first.featured_image %}
  {% assign image_width = first_image.width | times: 1.0 %}
  {% assign image_height = first_image.height | times: 1.0 %}
  {% assign auto_aspect_ratio = image_width | divided_by: image_height | round: 2 %}
  
  {%- comment -%} Convert to ratio format (e.g., 16/9, 4/3) {%- endcomment -%}
  {% if auto_aspect_ratio >= 1.7 and auto_aspect_ratio <= 1.8 %}
    {% assign detected_ratio = '16/9' %}
    {% assign detected_fit = 'cover' %}
  {% elsif auto_aspect_ratio >= 1.3 and auto_aspect_ratio <= 1.4 %}
    {% assign detected_ratio = '4/3' %}
    {% assign detected_fit = 'cover' %}
  {% elsif auto_aspect_ratio >= 1.4 and auto_aspect_ratio <= 1.6 %}
    {% assign detected_ratio = '3/2' %}
    {% assign detected_fit = 'cover' %}
  {% elsif auto_aspect_ratio >= 0.9 and auto_aspect_ratio <= 1.1 %}
    {% assign detected_ratio = '1/1' %}
    {% assign detected_fit = 'cover' %}
  {% elsif auto_aspect_ratio >= 0.55 and auto_aspect_ratio <= 0.58 %}
    {% assign detected_ratio = '9/16' %}
    {% assign detected_fit = 'contain' %}
  {% elsif auto_aspect_ratio >= 0.74 and auto_aspect_ratio <= 0.76 %}
    {% assign detected_ratio = '3/4' %}
    {% assign detected_fit = 'contain' %}
  {% else %}
    {%- comment -%} Use actual calculated ratio and smart fit detection {%- endcomment -%}
    {% assign width_rounded = image_width | round %}
    {% assign height_rounded = image_height | round %}
    {% assign detected_ratio = width_rounded | append: '/' | append: height_rounded %}
    {%- comment -%} Use contain for portrait/vertical, cover for landscape {%- endcomment -%}
    {% if auto_aspect_ratio < 0.8 %}
      {% assign detected_fit = 'contain' %}
    {% else %}
      {% assign detected_fit = 'cover' %}
    {% endif %}
  {% endif %}
{% else %}
  {% assign detected_ratio = '16/9' %}
  {% assign detected_fit = 'cover' %}
{% endif %}


{%- comment -%} Extract theme settings for CSS injection {%- endcomment -%}
{%- assign theme_accent_color = settings.colors_accent | default: '#000000' -%}
{%- assign theme_text_color = settings.colors_text | default: '#ffffff' -%}
{%- assign theme_background_color = settings.colors_background | default: '#ffffff' -%}
{%- assign theme_button_background = settings.colors_solid_button_labels | default: theme_accent_color -%}
{%- assign theme_button_text = settings.colors_solid_button_labels | default: '#ffffff' -%}

{%- comment -%} Theme-aware gradient defaults {%- endcomment -%}
{%- assign gradient_start = block.settings.gradient_color_start | default: theme_accent_color -%}
{%- assign gradient_end = block.settings.gradient_color_end | default: theme_accent_color -%}

{%- comment -%} Optional text customization (falls back to theme if empty) {%- endcomment -%}
{%- assign custom_text_color = block.settings.custom_text_color | default: '' -%}
{%- assign custom_title_size = block.settings.custom_title_size | default: '' -%}
{%- assign custom_subtitle_size = block.settings.custom_subtitle_size | default: '' -%}
{%- assign custom_price_size = block.settings.custom_price_size | default: '' -%}
{%- assign custom_button_size = block.settings.custom_button_size | default: '' -%}

<div class="shv-slider-wrapper" id="{{ section_id }}"
     style="--theme-accent: {{ theme_accent_color }};
            --theme-text: {{ theme_text_color }};
            --theme-bg: {{ theme_background_color }};
            --theme-btn-bg: {{ theme_button_background }};
            --theme-btn-text: {{ theme_button_text }};
            --gradient-start: {{ gradient_start }};
            --gradient-end: {{ gradient_end }};
            {% if custom_text_color != blank %}--custom-text-color: {{ custom_text_color }};{% endif %}
            {% if custom_title_size != blank %}--custom-title-size: {{ custom_title_size }};{% endif %}
            {% if custom_subtitle_size != blank %}--custom-subtitle-size: {{ custom_subtitle_size }};{% endif %}
            {% if custom_price_size != blank %}--custom-price-size: {{ custom_price_size }};{% endif %}
            {% if custom_button_size != blank %}--custom-button-size: {{ custom_button_size }};{% endif %}">

 <!-- list item -->
 <div class="shv-slider-track">
   {% for product in collection %} 
     <div class="shv-slide">
         <img src="{{ product.featured_image.src | img_url: 'master' }}" 
              alt="{{ product.featured_image.alt | escape }}" 
              class="slider-img" 
              width="{{ product.featured_image.width }}" 
              height="{{ product.featured_image.height }}" 
              loading="lazy">
         <div class="shv-slide-content">
               <div class="shv-slide-meta">
                 <a href="{{ product.url }}">
                    {{ product.title }}
                 </a>
               </div>
               <div class="shv-slide-title">
                <span class="price-span">
                  {{ product.price | money }}
                </span>
               </div>
               <div class="buttons">
                   <form action="/cart/add" method="post" enctype="multipart/form-data" onsubmit="submitAddToCartForm_{{ section.id }}(this); return false;">
                       <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                       <button type="submit" class="shv-add-to-cart-btn" aria-label="add to cart">
                         <svg width="30" height="30" viewBox="0 0 24 24" fill="none"
                           stroke="currentColor" 
                           stroke-width="1.5" 
                           stroke-linecap="round" stroke-linejoin="round">
                           <path d="M9 11a3 3 0 0 0 6 0" />
                           <path d="M8 6.5a4 4 0 0 1 8 0" />
                           <path d="M5 8h14v12a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V8z" />
                         </svg>
                         <p class="hide-on-mobile">Add to Cart</p>
                       </button>
                   </form> 
               </div>
       </div>
     </div>
     {% endfor %}
 </div>
 <!-- thumbnail section -->
 <div class="shv-slider-thumbs">
   {% for product in collection %}
     <div class="shv-slide">
         <img src="{{ product.featured_image.src | img_url: 'large' }}" 
              alt="{{ product.featured_image.alt | escape }}" 
              class="thumbnail-img" 
              width="540" 
              height="720" 
              loading="lazy">
     </div>
   {% endfor %}
 </div>
 <!-- navigation buttons -->
 <div class="shv-slider-nav">
     <button id="prev-{{ section.id }}" aria-label="Previous slide">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>
      <button id="next-{{ section.id }}" aria-label="Next slide">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="9 6 15 12 9 18"></polyline>
        </svg>
      </button>
 </div>
 <!-- progress bar -->
 <div class="slider-progress"></div>
</div>

<style>
/* Theme-Adaptive Scoped Styles */
#{{ section_id }} {
   height: var(--section-height, 100vh);
   width: 100%;
   overflow: hidden;
   position: relative;
   font-family: var(--font-body-family, inherit);
   font-size: var(--font-body-size, inherit);
   line-height: var(--font-body-line-height, 1.5);
   color: var(--color-text, var(--theme-text));
   box-sizing: border-box;
   z-index: 1;
   
   /* Responsive variables */
   --thumbnail-width: clamp(120px, 15vw, 180px);
   --thumbnail-height: clamp(180px, 22vw, 260px);
   --duration-default: 0.5s;
   --duration-long: 3s;
}

#{{ section_id }} * {
   box-sizing: border-box;
}

#{{ section_id }} .shv-slider-track {
   overflow: hidden;
   width: 100%;
   height: 100%;
   position: relative;
   z-index: 2;
}

#{{ section_id }} .shv-slider-track .shv-slide {
   width: 100%;
   height: 100%;
   position: absolute;
   top: 0;
   left: 0;
   right: 0;
   bottom: 0;
   display: flex;
   align-items: center;
   justify-content: center;
}

#{{ section_id }} .shv-slider-track .shv-slide .slider-img {
   width: 100%;
   height: 100%;
   object-fit: cover;
   display: block;
   border: none;
   outline: none;
   position: absolute;
   top: 50%;
   left: 50%;
   transform: translate(-50%, -50%);
   z-index: 1;
}

/* Large screen aspect ratio */
@media screen and (min-width: 1024px) {
   #{{ section_id }} .shv-slider-track .shv-slide .slider-img {
       aspect-ratio: {% if block.settings.aspect_ratio_large == 'auto' or block.settings.aspect_ratio_large == blank %}{{ detected_ratio }}{% else %}{{ block.settings.aspect_ratio_large }}{% endif %};
       object-fit: {% if block.settings.image_fit_large == 'auto' or block.settings.image_fit_large == blank %}{{ detected_fit }}{% else %}{{ block.settings.image_fit_large }}{% endif %};
   }
}

/* Medium screen aspect ratio */
@media screen and (min-width: 678px) and (max-width: 1023px) {
   #{{ section_id }} .shv-slider-track .shv-slide .slider-img {
       aspect-ratio: {% if block.settings.aspect_ratio_medium == 'auto' or block.settings.aspect_ratio_medium == blank %}{{ detected_ratio }}{% else %}{{ block.settings.aspect_ratio_medium }}{% endif %};
       object-fit: {% if block.settings.image_fit_medium == 'auto' or block.settings.image_fit_medium == blank %}{{ detected_fit }}{% else %}{{ block.settings.image_fit_medium }}{% endif %};
   }
}

/* Small screen aspect ratio */
@media screen and (max-width: 677px) {
   #{{ section_id }} .shv-slider-track .shv-slide .slider-img {
       aspect-ratio: {% if block.settings.aspect_ratio_small == 'auto' or block.settings.aspect_ratio_small == blank %}{{ detected_ratio }}{% else %}{{ block.settings.aspect_ratio_small }}{% endif %};
       object-fit: {% if block.settings.image_fit_small == 'auto' or block.settings.image_fit_small == blank %}{{ detected_fit }}{% else %}{{ block.settings.image_fit_small }}{% endif %};
   }
}

#{{ section_id }} .shv-slider-track .shv-slide .shv-slide-content {
   position: absolute;
   top: 30%;
   width: min(var(--page-width, 1140px), 80%);
   left: 50%;
   transform: translateX(-50%);
   padding-right: 30%;
   box-sizing: border-box;
   padding-top: 5%;
   text-shadow: 0 5px 10px rgba(0,0,0,0.267);
   animation: goDark 3s;
   z-index: 4;
}

@keyframes goDark {
   0% { opacity: 0; }
   80% { opacity: 0; }
   100% { opacity: 1; }
}

/* Product Meta/Subtitle - Adopts theme subtitle styles */
#{{ section_id }} .shv-slider-track .shv-slide .shv-slide-meta {
    font-weight: var(--font-heading-weight, var(--font-body-weight-bold, 700));
    letter-spacing: var(--text-letter-spacing, inherit);
    text-transform: var(--text-transform, inherit);
}

#{{ section_id }} .shv-slider-track .shv-slide .shv-slide-meta a {
    color: var(--custom-text-color, var(--color-text, inherit));
    text-decoration: none;
    font-size: var(--custom-subtitle-size, var(--font-heading-scale, 1em));
    font-family: var(--font-heading-family, var(--font-body-family, inherit));
    font-weight: var(--font-heading-weight, 700);
    letter-spacing: inherit;
    text-transform: inherit;
}

#{{ section_id }} .shv-slider-track .shv-slide .shv-slide-meta a:hover {
    text-decoration: underline;
}

/* Main Title - Adopts theme H1/heading styles */
#{{ section_id }} .shv-slider-track .shv-slide .shv-slide-title,
#{{ section_id }} .shv-slider-track .shv-slide .topic {
    font-size: var(--custom-title-size, var(--font-heading-size, 3rem));
    font-weight: var(--font-heading-weight, var(--font-body-weight-bold, 700));
    font-family: var(--font-heading-family, var(--font-body-family, inherit));
    line-height: var(--font-heading-line-height, 1.2);
    letter-spacing: var(--heading-letter-spacing, inherit);
    text-transform: var(--heading-text-transform, inherit);
}

/* Price - Adopts theme price/subtitle styles */
#{{ section_id }} .shv-slider-track .shv-slide .price-span {
    color: var(--custom-text-color, var(--color-text, inherit));
    font-size: var(--custom-price-size, var(--font-heading-scale, 1.5rem));
    font-weight: var(--font-heading-weight, 600);
    font-family: var(--font-heading-family, var(--font-body-family, inherit));
    letter-spacing: inherit;
    text-transform: inherit;
}

/* thumbnail - theme adaptive sizing */
#{{ section_id }} .shv-slider-thumbs {
   position: absolute;
   bottom: var(--spacing-large, 3rem);
   left: 50%;
   width: max-content;
   z-index: 5;
   display: flex;
   gap: var(--spacing-medium, 1.25rem);
   overflow: hidden;
}

#{{ section_id }} .shv-slider-thumbs .shv-slide {
    width: var(--thumbnail-width);
    height: var(--thumbnail-height);
    flex-shrink: 0;
    position: relative;
}

#{{ section_id }} .shv-slider-thumbs .shv-slide img {
   width: 100%;
   height: 100%;
   object-fit: cover;
   border-radius: var(--radius-base, var(--media-radius, 0.5rem));
   display: block;
   border: none;
   outline: none;
}

/* add to Cart button - theme adaptive */
#{{ section_id }} .shv-add-to-cart-btn {
    background: transparent;
    border: none;
    padding: var(--spacing-small, 0.5rem) var(--spacing-medium, 0.75rem);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: var(--spacing-small, 0.5rem);
    font-family: var(--font-button-family, var(--font-body-family, inherit));
    font-size: var(--custom-button-size, var(--font-heading-scale, 1.5rem));
    font-weight: var(--font-button-weight, var(--font-body-weight-bold, 600));
    color: var(--custom-text-color, var(--color-text, inherit));
    text-decoration: none;
    outline: none;
    transition: transform 0.2s ease;
    letter-spacing: var(--button-letter-spacing, inherit);
    text-transform: var(--button-text-transform, inherit);
}

#{{ section_id }} .shv-add-to-cart-btn:hover {
   text-decoration: none;
   transform: scale(1.05);
}

#{{ section_id }} .shv-add-to-cart-btn svg {
    color: var(--custom-text-color, var(--color-text, inherit));
}

#{{ section_id }} .shv-add-to-cart-btn p {
    margin: 0;
    padding: 0;
    color: var(--custom-text-color, var(--color-text, inherit));
}

/* navigation arrows - theme adaptive */
#{{ section_id }} .shv-slider-nav {
   position: absolute;
   top: 80%;
   right: 52%;
   z-index: 6;
   width: auto;
   max-width: min(300px, 30%);
   display: flex;
   gap: var(--spacing-medium, 2rem);
   align-items: center;
}

#{{ section_id }} .shv-slider-nav button {
   width: var(--buttons-radius, clamp(40px, 5vw, 56px));
   height: var(--buttons-radius, clamp(40px, 5vw, 56px));
   border-radius: var(--buttons-radius-outset, 50%);
   background-color: var(--color-button, var(--color-background, rgba(255, 255, 255, 0.2)));
   backdrop-filter: blur(10px);
   -webkit-backdrop-filter: blur(10px);
   border: 1px solid rgba(255, 255, 255, 0.3);
   color: var(--color-button-text, var(--color-text, #1a1a1a));
   transition: all var(--duration-short, 0.3s) ease;
   cursor: pointer;
   outline: none;
   position: relative;
   box-shadow: var(--shadow-base, 0 4px 15px rgba(0, 0, 0, 0.2));
   /* Flexbox centering for SVG icons */
   display: flex;
   align-items: center;
   justify-content: center;
   padding: 0;
}

#{{ section_id }} .shv-slider-nav button svg {
   width: clamp(18px, 2.5vw, 24px);
   height: clamp(18px, 2.5vw, 24px);
   stroke: currentColor;
   flex-shrink: 0;
   transition: stroke 0.3s ease;
}

#{{ section_id }} .shv-slider-nav button::before {
   content: '';
   position: absolute;
   top: -3px;
   left: -3px;
   right: -3px;
   bottom: -3px;
   border-radius: 50%;
   background: conic-gradient(from 0deg, transparent 0deg, var(--color-accent, var(--theme-accent, #f1683a)) 180deg, transparent 180deg);
   animation: rotateBorder-{{ section.id }} 2s linear infinite;
   z-index: -1;
}

#{{ section_id }} .shv-slider-nav button::after {
   content: '';
   position: absolute;
   top: -1px;
   left: -1px;
   right: -1px;
   bottom: -1px;
   border-radius: 50%;
   background: rgba(255, 255, 255, 0.95);
   z-index: -1;
}

@keyframes rotateBorder-{{ section.id }} {
   0% { transform: rotate(0deg); }
   100% { transform: rotate(360deg); }
}

#{{ section_id }} .shv-slider-nav button:hover {
   background-color: var(--color-button-hover, var(--color-accent, var(--theme-accent, #f1683a)));
   color: var(--color-button-text-hover, var(--color-background, #fff));
   transform: scale(1.1);
   box-shadow: var(--shadow-hover, 0 6px 20px rgba(0, 0, 0, 0.3));
}

/* animation */
#{{ section_id }} .shv-slider-track .shv-slide:nth-child(1) {
   z-index: 2;
}

/* Show content only for the first (active) slide */
#{{ section_id }} .shv-slider-track .shv-slide:nth-child(1) .shv-slide-content {
   display: flex;
   flex-direction: column;
   align-items: flex-start;
   opacity: 1;
   visibility: visible;
}

/* Hide content for all other slides */
#{{ section_id }} .shv-slider-track .shv-slide:not(:nth-child(1)) .shv-slide-content {
   opacity: 0;
   visibility: hidden;
   display: none;
}

/* General Content Animation */
#{{ section_id }} .shv-slider-track .shv-slide:nth-child(1) .shv-slide-content .shv-slide-meta,
#{{ section_id }} .shv-slider-track .shv-slide:nth-child(1) .shv-slide-content .shv-slide-title,
#{{ section_id }} .shv-slider-track .shv-slide:nth-child(1) .shv-slide-content .topic,
#{{ section_id }} .shv-slider-track .shv-slide:nth-child(1) .shv-slide-content .des,
#{{ section_id }} .shv-slider-track .shv-slide:nth-child(1) .shv-slide-content .buttons {
   position: relative;
   padding: 0px var(--spacing-small, 0.9375rem);
   display: inline-block;
   width: auto;
   transform: translateY(50px);
   filter: blur(20px);
   opacity: 0;
   animation: showContent-{{ section.id }} 0.5s 1s linear 1 forwards;
   animation-fill-mode: forwards;
   overflow: hidden;
}

/* Background Animation */
{% if block.settings.enable_gradient_background %}
#{{ section_id }} .shv-slider-track .shv-slide:nth-child(1) .shv-slide-content .shv-slide-meta::before,
#{{ section_id }} .shv-slider-track .shv-slide:nth-child(1) .shv-slide-content .shv-slide-title::before,
#{{ section_id }} .shv-slider-track .shv-slide:nth-child(1) .shv-slide-content .topic::before,
#{{ section_id }} .shv-slider-track .shv-slide:nth-child(1) .shv-slide-content .des::before,
#{{ section_id }} .shv-slider-track .shv-slide:nth-child(1) .shv-slide-content .buttons::before {
   content: "";
   position: absolute;
   top: 0;
   left: -100%;
   width: 100%;
   height: 100%;
    background: linear-gradient(to right, 
                  color-mix(in srgb, var(--gradient-start) 50%, transparent),
                  color-mix(in srgb, var(--gradient-end) 10%, transparent));
   z-index: -1;
   animation: bgAnimate-{{ section.id }} 0.8s ease-in-out 0.8s forwards;
   animation-fill-mode: forwards;
   border-radius: {{ block.settings.gradient_border_radius }}px;
   {% if block.settings.gradient_shape == 'rounded' %}
   border-radius: {{ block.settings.gradient_border_radius }}px;
   {% elsif block.settings.gradient_shape == 'pill' %}
   border-radius: 9999px;
   {% elsif block.settings.gradient_shape == 'angled-left' %}
   clip-path: polygon(0 0, 100% 0, 95% 100%, 0% 100%);
   {% elsif block.settings.gradient_shape == 'slashed' %}
   clip-path: polygon(10% 0%, 100% 0%, 90% 100%, 0% 100%);
   {% elsif block.settings.gradient_shape == 'angled-right' %}
   clip-path: polygon(5% 0, 100% 0, 100% 100%, 0% 100%);
   {% elsif block.settings.gradient_shape == 'chevron-right' %}
   clip-path: polygon(0 0, 90% 0, 100% 50%, 90% 100%, 0 100%);
   {% elsif block.settings.gradient_shape == 'chevron-left' %}
   clip-path: polygon(10% 0, 100% 0, 100% 100%, 10% 100%, 0 50%);
   {% elsif block.settings.gradient_shape == 'notch-right' %}
   clip-path: polygon(0 0, 100% 0, 100% 15%, 95% 50%, 100% 85%, 100% 100%, 0 100%);
   {% elsif block.settings.gradient_shape == 'wave' %}
   clip-path: polygon(0 0, 100% 0, 100% 85%, 95% 90%, 90% 95%, 85% 100%, 0 100%);
   {% elsif block.settings.gradient_shape == 'diagonal-cut' %}
   clip-path: polygon(0 0, 100% 0, 85% 100%, 0 100%);
   {% endif %}
}
{% endif %}

/* Keyframes for Background Animation */
@keyframes bgAnimate-{{ section.id }} {
   to { left: 0; }
}

/* Show Content Keyframes */
@keyframes showContent-{{ section.id }} {
   to {
       transform: translateY(0px);
       filter: blur(0px);
       opacity: 1;
   }
}

/* Individual Animation Delays */
#{{ section_id }} .shv-slider-track .shv-slide:nth-child(1) .shv-slide-content .shv-slide-title {
   animation-delay: 1.2s;
}
#{{ section_id }} .shv-slider-track .shv-slide:nth-child(1) .shv-slide-content .topic {
   animation-delay: 1.4s;
}
#{{ section_id }} .shv-slider-track .shv-slide:nth-child(1) .shv-slide-content .des {
   animation-delay: 1.6s;
}
#{{ section_id }} .shv-slider-track .shv-slide:nth-child(1) .shv-slide-content .buttons {
   animation-delay: 1.8s;
}

#{{ section_id }} .shv-slider-track .shv-slide:nth-child(1) .shv-slide-content .shv-slide-title::before {
   animation-delay: 1.4s;
}
#{{ section_id }} .shv-slider-track .shv-slide:nth-child(1) .shv-slide-content .topic::before {
   animation-delay: 1.6s;
}
#{{ section_id }} .shv-slider-track .shv-slide:nth-child(1) .shv-slide-content .des::before {
   animation-delay: 2s;
}
#{{ section_id }} .shv-slider-track .shv-slide:nth-child(1) .shv-slide-content .buttons::before {
   animation-delay: 1.6s;
}

/* SMOOTH Image slide-in animation for NEXT - theme adaptive sizing */
#{{ section_id }}.next .shv-slider-track .shv-slide:nth-child(1) .slider-img {
    width: var(--thumbnail-width);
    height: var(--thumbnail-height);
    position: absolute;
    bottom: var(--spacing-large, 3rem);
    left: 50%;
    border-radius: var(--radius-base, 1.875rem);
    transform: translateX(-50%);
    animation: showImage-{{ section.id }} var(--duration-default) linear 1 forwards;
    z-index: 3;
}

@keyframes showImage-{{ section.id }} {
   to {
       top: 50%;
       left: 50%;
       transform: translate(-50%, -50%);
       width: 100%;
       height: 100%;
       bottom: auto;
       border-radius: 0;
   }
}

/* SMOOTH Image slide-out animation for PREV - theme adaptive */
#{{ section_id }}.prev .shv-slider-track .shv-slide:nth-child(2) .slider-img {
    animation: outFrame-{{ section.id }} var(--duration-default) linear 1 forwards;
    z-index: 3;
}

@keyframes outFrame-{{ section.id }} {
    to {
        width: var(--thumbnail-width);
        height: var(--thumbnail-height);
        bottom: var(--spacing-large, 3rem);
        top: auto;
        left: 50%;
        transform: translateX(-50%);
        border-radius: var(--radius-base, 1.25rem);
    }
}

#{{ section_id }}.next .shv-slider-thumbs .shv-slide:nth-last-child(1) {
   overflow: hidden;
   animation: showThumbnail-{{ section.id }} var(--duration-default) linear 1 forwards;
}

@keyframes showThumbnail-{{ section.id }} {
   from {
       width: 0;
       opacity: 0;
   }
}

#{{ section_id }}.next .shv-slider-thumbs {
   animation: effectNext-{{ section.id }} var(--duration-default) linear 1 forwards;
}

@keyframes effectNext-{{ section.id }} {
   from {
       transform: translateX(var(--thumbnail-width));
   }
}

/* running time */
#{{ section_id }} .time {
   position: absolute;
   z-index: 7;
   width: 0%;
   height: 3px;
   background-color: var(--color-accent, var(--theme-accent, #f1683a));
   left: 0;
   top: 0;
}

#{{ section_id }}.next .time,
#{{ section_id }}.prev .time {
   animation: runningTime-{{ section.id }} var(--duration-long) linear 1 forwards;
}

@keyframes runningTime-{{ section.id }} {
   from { width: 100% }
   to { width: 0 }
}

/* prev click */
#{{ section_id }}.prev .shv-slider-track .shv-slide:nth-child(2) {
   z-index: 2;
}

#{{ section_id }}.prev .shv-slider-thumbs .shv-slide:nth-child(1) {
   overflow: hidden;
   opacity: 0;
   animation: showThumbnail-{{ section.id }} 0.5s linear 1 forwards;
}

#{{ section_id }}.next .shv-slider-nav button,
#{{ section_id }}.prev .shv-slider-nav button {
   pointer-events: none;
}

/* Show content for second slide during prev animation */
#{{ section_id }}.prev .shv-slider-track .shv-slide:nth-child(2) .shv-slide-content {
   opacity: 1;
   visibility: visible;
   display: flex;
}

#{{ section_id }}.prev .shv-slider-track .shv-slide:nth-child(2) .shv-slide-content .shv-slide-meta,
#{{ section_id }}.prev .shv-slider-track .shv-slide:nth-child(2) .shv-slide-content .shv-slide-title,
#{{ section_id }}.prev .shv-slider-track .shv-slide:nth-child(2) .shv-slide-content .topic,
#{{ section_id }}.prev .shv-slider-track .shv-slide:nth-child(2) .shv-slide-content .des,
#{{ section_id }}.prev .shv-slider-track .shv-slide:nth-child(2) .shv-slide-content .buttons {
   animation: contentOut-{{ section.id }} 1.5s linear 1 forwards;
}

@keyframes contentOut-{{ section.id }} {
   to {
       transform: translateY(-150px);
       filter: blur(20px);
       opacity: 0;
   }
}

/* Responsive adjustments */
/* Responsive adjustments - maintain theme consistency on mobile */
@media screen and (max-width: 678px) {
    #{{ section_id }} .shv-slider-track .shv-slide .shv-slide-content {
        padding-right: 0;
    }
    /* Let mobile sizes scale naturally from theme variables */
    #{{ section_id }} .shv-slider-track .shv-slide .shv-slide-title {
        font-size: calc(var(--font-heading-size, 2rem) * 0.75);
    }
    #{{ section_id }} .shv-slider-track .shv-slide .shv-slide-meta a {
        font-size: calc(var(--font-heading-scale, 1rem) * 0.9);
    }
    #{{ section_id }} .shv-slider-track .shv-slide .price-span {
        font-size: calc(var(--font-heading-scale, 1.5rem) * 0.85);
    }
    #{{ section_id }} .hide-on-mobile {
        display: none;
    }
}
</style>

<script>
(function() {
   const sectionId = '{{ section.id }}';
   const carouselWrapper = document.getElementById('{{ section_id }}');
   
   if (!carouselWrapper) return;
   
   const nextDom = document.getElementById('next-' + sectionId);
   const prevDom = document.getElementById('prev-' + sectionId);
   const SliderDom = carouselWrapper.querySelector('.shv-slider-track');
   const thumbnailBorderDom = carouselWrapper.querySelector('.shv-slider-thumbs');
   let thumbnailItemsDom = thumbnailBorderDom.querySelectorAll('.shv-slide');
   
   if (thumbnailItemsDom.length > 0) {
       thumbnailBorderDom.appendChild(thumbnailItemsDom[0]);
   }
   
   const timeRunning = 3000;
   const timeAutoNext = 7000;

   let runTimeOut;
   let runNextAuto = setTimeout(() => {
       if (nextDom) nextDom.click();
   }, timeAutoNext);

   function showSlider(type) {
       const SliderItemsDom = SliderDom.querySelectorAll('.shv-slide');
       const thumbnailItemsDom = carouselWrapper.querySelectorAll('.shv-slider-thumbs .shv-slide');
       
       if (type === 'next') {
           SliderDom.appendChild(SliderItemsDom[0]);
           thumbnailBorderDom.appendChild(thumbnailItemsDom[0]);
           carouselWrapper.classList.add('next');
       } else {
           SliderDom.prepend(SliderItemsDom[SliderItemsDom.length - 1]);
           thumbnailBorderDom.prepend(thumbnailItemsDom[thumbnailItemsDom.length - 1]);
           carouselWrapper.classList.add('prev');
       }
       
       clearTimeout(runTimeOut);
       runTimeOut = setTimeout(() => {
           carouselWrapper.classList.remove('next');
           carouselWrapper.classList.remove('prev');
       }, timeRunning);

       clearTimeout(runNextAuto);
       runNextAuto = setTimeout(() => {
           if (nextDom) nextDom.click();
       }, timeAutoNext);
   }

   if (nextDom) {
       nextDom.onclick = function() {
           showSlider('next');
       };
   }

   if (prevDom) {
       prevDom.onclick = function() {
           showSlider('prev');
       };
   }

   window['submitAddToCartForm_' + sectionId] = function(form) {
       fetch('/cart/add.js', {
           method: 'POST',
           headers: {
               'Content-Type': 'application/x-www-form-urlencoded',
           },
           body: new URLSearchParams(new FormData(form))
       }).then(response => response.json())
         .then(data => {
             console.log('Product added to cart:', data);
         })
         .catch(error => {
             console.error('Error adding to cart:', error);
         });
   };
})();
</script>

{% schema %}
{
  "name": "Carousel Slider",
  "target": "section",
  "settings": [
    {
      "type": "collection",
      "id": "selected_collection",
      "label": "Select Collection"
    },
    {
      "type": "header",
      "content": "Large Screen Settings (Desktop 1024px+)"
    },
    {
      "type": "select",
      "id": "aspect_ratio_large",
      "label": "Aspect Ratio (Large)",
      "options": [
        {
          "value": "auto",
          "label": "Auto (Detect from images)"
        },
        {
          "value": "16/9",
          "label": "16:9 (Widescreen)"
        },
        {
          "value": "21/9",
          "label": "21:9 (Ultra-wide)"
        },
        {
          "value": "4/3",
          "label": "4:3 (Standard)"
        },
        {
          "value": "3/2",
          "label": "3:2 (Classic)"
        },
        {
          "value": "1/1",
          "label": "1:1 (Square)"
        },
        {
          "value": "3/4",
          "label": "3:4 (Portrait)"
        },
        {
          "value": "9/16",
          "label": "9:16 (Vertical)"
        }
      ],
      "default": "auto",
      "info": "Select 'Auto' to detect from product images or choose a specific ratio"
    },
    {
      "type": "select",
      "id": "image_fit_large",
      "label": "Image Fit (Large)",
      "options": [
        {
          "value": "contain",
          "label": "Contain - Full image visible"
        },
        {
          "value": "cover",
          "label": "Cover - Fill space, may crop"
        },
        {
          "value": "fill",
          "label": "Fill - Stretch to fit"
        }
      ],
      "default": "cover"
    },
    {
      "type": "header",
      "content": "Medium Screen Settings (Tablet 678px-1023px)"
    },
    {
      "type": "select",
      "id": "aspect_ratio_medium",
      "label": "Aspect Ratio (Medium)",
      "options": [
        {
          "value": "auto",
          "label": "Auto (Detect from images)"
        },
        {
          "value": "16/9",
          "label": "16:9 (Widescreen)"
        },
        {
          "value": "4/3",
          "label": "4:3 (Standard)"
        },
        {
          "value": "3/2",
          "label": "3:2 (Classic)"
        },
        {
          "value": "1/1",
          "label": "1:1 (Square)"
        },
        {
          "value": "3/4",
          "label": "3:4 (Portrait)"
        },
        {
          "value": "9/16",
          "label": "9:16 (Vertical)"
        }
      ],
      "default": "auto",
      "info": "Select 'Auto' to detect from product images or choose a specific ratio"
    },
    {
      "type": "select",
      "id": "image_fit_medium",
      "label": "Image Fit (Medium)",
      "options": [
        {
          "value": "contain",
          "label": "Contain - Full image visible"
        },
        {
          "value": "cover",
          "label": "Cover - Fill space, may crop"
        },
        {
          "value": "fill",
          "label": "Fill - Stretch to fit"
        }
      ],
      "default": "cover"
    },
    {
      "type": "header",
      "content": "Small Screen Settings (Mobile <678px)"
    },
    {
      "type": "select",
      "id": "aspect_ratio_small",
      "label": "Aspect Ratio (Small)",
      "options": [
        {
          "value": "auto",
          "label": "Auto (Detect from images)"
        },
        {
          "value": "9/16",
          "label": "9:16 (Vertical/Stories)"
        },
        {
          "value": "3/4",
          "label": "3:4 (Portrait)"
        },
        {
          "value": "1/1",
          "label": "1:1 (Square)"
        },
        {
          "value": "4/3",
          "label": "4:3 (Standard)"
        },
        {
          "value": "16/9",
          "label": "16:9 (Widescreen)"
        }
      ],
      "default": "auto",
      "info": "Select 'Auto' to detect from product images or choose a specific ratio"
    },
    {
      "type": "select",
      "id": "image_fit_small",
      "label": "Image Fit (Small)",
      "options": [
        {
          "value": "contain",
          "label": "Contain - Full image visible"
        },
        {
          "value": "cover",
          "label": "Cover - Fill space, may crop"
        },
        {
          "value": "fill",
          "label": "Fill - Stretch to fit"
        }
      ],
      "default": "cover"
    },
    {
      "type": "header",
      "content": "Text Customization (Optional)"
    },
    {
      "type": "paragraph",
      "content": "Leave these empty to automatically use your theme's styling. Only customize if you want to override the theme defaults."
    },
    {
      "type": "color",
      "id": "custom_text_color",
      "label": "Text Color Override",
      "info": "Leave empty to use theme text color"
    },
    {
      "type": "text",
      "id": "custom_title_size",
      "label": "Title Font Size (e.g., 3rem, 48px)",
      "info": "Leave empty to use theme heading size. Examples: 3rem, 48px, 4em"
    },
    {
      "type": "text",
      "id": "custom_subtitle_size",
      "label": "Product Name Font Size (e.g., 1.5rem, 24px)",
      "info": "Leave empty to use theme subtitle size. Examples: 1.5rem, 24px"
    },
    {
      "type": "text",
      "id": "custom_price_size",
      "label": "Price Font Size (e.g., 2rem, 32px)",
      "info": "Leave empty to use theme price size. Examples: 2rem, 32px, 2.5em"
    },
    {
      "type": "text",
      "id": "custom_button_size",
      "label": "Button Text Size (e.g., 1.25rem, 20px)",
      "info": "Leave empty to use theme button size. Examples: 1.25rem, 20px"
    },
    {
      "type": "header",
      "content": "Gradient Background"
    },
    {
      "type": "checkbox",
      "id": "enable_gradient_background",
      "label": "Enable Gradient Background",
      "default": true,
      "info": "Toggle the animated gradient background behind text"
    },
    {
      "type": "select",
      "id": "gradient_shape",
      "label": "Gradient Shape Style",
      "options": [
        {
          "value": "rectangle",
          "label": "Rectangle (Default)"
        },
        {
          "value": "rounded",
          "label": "Rounded Corners"
        },
        {
          "value": "pill",
          "label": "Pill Shape (Fully Rounded)"
        },
        {
          "value": "slashed",
          "label": "Slashed"
        },
        {
          "value": "angled-left",
          "label": "Angled Left Edge"
        },
        {
          "value": "angled-right",
          "label": "Angled Right Edge"
        },
        {
          "value": "chevron-right",
          "label": "Chevron Pointing Right"
        },
        {
          "value": "chevron-left",
          "label": "Chevron Pointing Left"
        },
        {
          "value": "notch-right",
          "label": "Notch on Right"
        },
        {
          "value": "wave",
          "label": "Wave Bottom Right"
        },
        {
          "value": "diagonal-cut",
          "label": "Diagonal Cut"
        }
      ],
      "default": "rectangle",
      "info": "Choose the shape style for the gradient background"
    },
    {
      "type": "range",
      "id": "gradient_border_radius",
      "label": "Border Radius (for Rounded style)",
      "min": 0,
      "max": 50,
      "step": 1,
      "default": 0,
      "unit": "px",
      "info": "Only applies when 'Rounded Corners' is selected"
    },
    {
      "type": "color",
      "id": "gradient_color_start",
      "label": "Gradient Start Color",
      "info": "Leave empty to use theme accent color. Choose a custom color to override."
    },
    {
      "type": "color",
      "id": "gradient_color_end",
      "label": "Gradient End Color",
      "info": "Leave empty to use theme accent color. Choose a custom color to override."
    }
  ]
}
{% endschema %}
